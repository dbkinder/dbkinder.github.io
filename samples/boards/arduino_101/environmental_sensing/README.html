

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" > <!--<![endif]-->
  <head>
    <meta charset="utf-8">
   <!-- Google Tag Manager -->
   <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
   new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
   j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
   })(window,document,'script','dataLayer','GTM-KMP8MS');</script>
   <!-- End Google Tag Manager -->
    <link rel="apple-touch-icon" sizes="57x57" href="../../../../_static/img/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../../../../_static/img/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../../../../_static/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../../../../_static/img/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../../../../_static/img/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../../../../_static/img/apple-touch-icon-120x120.png">
    <link rel="icon" type="image/png" href="../../../../_static/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../../../_static/img/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="../../../../_static/img/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="../../../../_static/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Zephyr Project">
    <meta name="application-name" content="Zephyr Project">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    
    <title>Environmental Sensing Sample &mdash; Zephyr Project Documentation</title>
    

    
    

    

    
    
      
    

    
    
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
    

    
      <link rel="stylesheet" href="../../../../_static/zephyr-custom.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../../_static/css/normalize.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../../_static/css/layout.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../../_static/css/main.css" type="text/css" />
    
      <link rel="stylesheet" href="../../../../_static/css/custom.css" type="text/css" />
    

    
        <link rel="index" title="Index" href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
        <link rel="copyright" title="Copyright" href="../../../../copyright.html"/>
      <link rel="top" title="Zephyr Project Documentation" href="../../../../index.html"/>
        <link rel="up" title="Arduino 101 Samples" href="../arduino_101.html"/>
        <link rel="next" title="BBC micro:bit display" href="../../microbit/display/README.html"/>
        <link rel="prev" title="Arduino 101 Samples" href="../arduino_101.html"/> 

    
    <script src="../../../../_static/js/modernizr.min.js"></script>

  </head>

  <body class="not-front page-documentation one-sidebar sidebar-first" role="document" >
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KMP8MS"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="page">
      <header id="header">
  <div class="header-wrapper">
    <div class="container">
      <a href="https://zephyrproject.org/" title="Zephyr Project" rel="home" id="logo">
        <img src="../../../../_static/img/logo_white.png" alt="Zephyr Project">
      </a>
      <a href="" id="navigation-toggle">
        <span> </span>
        Menu
      </a>
      <nav id="navigation" class="menu with-primary with-secondary">
        <ul class="header-menu main-menu">
          <li class="first expanded about mid-1209"><a href="https://zephyrproject.org/about/"><span>About</span></a>
            <ul class="menu">
              <li class="first leaf what-is-zephyr mid-2563"><a href="https://zephyrproject.org/what-is-zephyr/"><span>What is the Zephyr Project?</span></a></li>
              <li class="leaf organization mid-2564"><a href="https://zephyrproject.org/about/organization/"><span>Organization</span></a></li>
              <li class="leaf memberships mid-2532"><a href="https://zephyrproject.org/#members"><span>Members</span></a></li>
              <li class="leaf faq mid-2525"><a href="https://zephyrproject.org/about/#faq"><span>FAQ</span></a></li>
              <li class="leaf join mid-2622"><a href="https://zephyrproject.org/join/"><span>Join</span></a></li>
              <li class="last leaf contact-us mid-2530"><a href="https://zephyrproject.org/about/#contact-us"><span>Contact Us</span></a></li>
            </ul>
          </li>
          <li class="expanded developers mid-1209"><a href="https://zephyrproject.org/developers/"><span>Developers</span></a>
            <ul class="menu">
              <li class="first expanded leaf code mid-2563"><a href="https://github.com/zephyrproject-rtos/zephyr/" target="_blank"><span>Code</span></a></li>
              <li class="leaf downloads mid-2564"><a href="https://zephyrproject.org/developers/#downloads"><span>Downloads</span></a></li>
              <li class="leaf documentation mid-2564"><a href="http://docs.zephyrproject.org/index.html" target="_blank"><span>Documentation</span></a></li>
              <li class="leaf supported-boards mid-2564"><a href="http://docs.zephyrproject.org/boards/boards.html" target="_blank"><span>Supported Boards</span></a></li>
              <li class="leaf releases-overview mid-2564"><a href="https://zephyrproject.org/developers/#releases-overview"><span>Releases Overview</span></a></li>
              <li class="leaf how-to-contribute mid-2564"><a href="https://zephyrproject.org/developers/how-to-contribute/"><span>How to Contribute</span></a></li>
              <li class="last leaf community-guidelines mid-2564"><a href="https://zephyrproject.org/developers/how-to-contribute/#community-guidelines"><span>Community Guidelines</span></a></li>
            </ul>
          </li>
          <li class="expanded news mid-1209"><a href="https://zephyrproject.org/news/"><span>News</span></a>
            <ul class="menu">
              <li class="first leaf announcements mid-2563"><a href="https://zephyrproject.org/news/announcements/"><span>Announcements</span></a></li>
              <li class="leaf blog mid-2563"><a href="https://zephyrproject.org/news/blog/"><span>Blog</span></a></li>
              <li class="last leaf events mid-2563"><a href="https://zephyrproject.org/events/"><span>Events</span></a></li>
            </ul>
          </li>
          <li class="last expanded project-resources mid-1209"><a href="https://zephyrproject.org/project-resources/"><span>Project Resources</span></a>
            <ul class="menu">
              <li class="first leaf presentations mid-2563"><a href="https://zephyrproject.org/project-resources/presentations/"><span>Presentations</span></a></li>
              <li class="leaf videos mid-2563"><a href="https://zephyrproject.org/project-resources/videos/"><span>Videos</span></a></li>
              <li class="leaf demos mid-2563"><a href="https://zephyrproject.org/project-resources/demos/"><span>Demos</span></a></li>
              <li class="leaf zephyr-in-market mid-2563"><a href="https://zephyrproject.org/project-resources/zephyr-in-market/"><span>Zephyr in Market</span></a></li>
              <li class="last leaf developer-tools mid-2563"><a href="https://zephyrproject.org/project-resources/developer-tools/"><span>Developer Tools</span></a></li>
            </ul>
          </li>
        </ul>
      </nav><!-- /navigation -->
    </div>
  </div>
</header><!-- /header -->
      <!-- STARTS #main -->
      <div id="main">
        <!-- STARTS .main-container -->
        <div class="main-container">
          

 



<!-- Docs -->





<div id="breadcrumb">
  <div class="container">
    <a href="/">Home</a> / 
    <a href="../../../../index.html">Docs</a> /
      
          <a href="../../../../application/index.html">Developer Guides</a> /
      
          <a href="../../../samples.html">Samples and Demos</a> /
      
          <a href="../../boards.html">Board-specific samples</a> /
      
          <a href="../arduino_101.html">Arduino 101 Samples</a> /
      
  </div>
</div>
          <aside id="sidebar-first" class="container-sidebar">
            
            <span id="secondary-menu-button" class="">Documentation</span>
<div class="region region-sidebar">
  <div class="docs-menu">
  
    
    
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction/introducing_zephyr.html">Introducing Zephyr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/getting_started.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contribute/contribute.html">Contributing to the Zephyr Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kernel/kernel.html">Zephyr Kernel Primer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security/security.html">Zephyr Project Security</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../application/index.html">Developer Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../porting/porting.html">Porting Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../application/application.html">Application Development Primer</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../samples.html">Samples and Demos</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../kernel.html">Kernel Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../basic/basic.html">Basic Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../subsys/subsys.html">Various Subsystems Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../net/net.html">Networking Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../bluetooth/bluetooth.html">Bluetooth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../sensor/sensor.html">Sensor Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../grove/grove.html">Grove Kit Samples</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../boards.html">Board-specific samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../mpu/index.html">MMU/MPU Samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../drivers/drivers.html">Driver Samples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../reference/kconfig/index.html">Configuration Options Reference Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api/api.html">API Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../README.html">Zephyr documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../boards/boards.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devices/index.html">Device and Driver Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../subsystems/subsystems.html">Subsystems</a></li>
</ul>

    
  
  </div>
<div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</div>
          </aside>
          <!-- STARTS .content SECTION-->
          <section id="content" class="row">
            
	    
            <div class="rst-content">
              <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                <div itemprop="articleBody">
                  
  <div class="section" id="environmental-sensing-sample">
<span id="env-sensing-sample"></span><h1>Environmental Sensing Sample<a class="headerlink" href="#environmental-sensing-sample" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This sample implements a simple environmental sensing service using the Arduino
101 board.</p>
<p>The sensor subsystem application collects temperature, humidity and pressure
data from a set of sensors connected to the Arduino 101 and sends it to the SoC
through IPM. The collected sensor data is also displayed by the sensor subsystem
on a Grove LCD.</p>
<p>The application processor exposes the received sensor data as a simple Bluetooth
Environmental Sensing Service.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>To use this sample, the following hardware is required:</p>
<ul class="simple">
<li>Arduino 101</li>
<li><a class="reference external" href="http://wiki.seeed.cc/Grove-LCD_RGB_Backlight/">Grove LCD module</a></li>
<li><a class="reference external" href="http://wiki.seeedstudio.com/wiki/Grove_-_Base_Shield">Grove Base Shield</a> [Optional]</li>
<li><a class="reference external" href="https://www.adafruit.com/product/2635">HDC1008 Sensor</a></li>
<li><a class="reference external" href="https://www.adafruit.com/products/2652">BME280 Sensor</a></li>
</ul>
</div>
<div class="section" id="wiring">
<h2>Wiring<a class="headerlink" href="#wiring" title="Permalink to this headline">¶</a></h2>
<div class="section" id="external-wiring">
<h3>External Wiring<a class="headerlink" href="#external-wiring" title="Permalink to this headline">¶</a></h3>
<p>The sample uses the HDC1008 sensor for temperature and humidity measurement, and
the BMP280 sensor for pressure measurement. This section describes how to wire
these sensors to the Arduino 101 board.</p>
<p>Both sensors operate at 3.3V and use I2C to communicate with the Arduino. On the
Arduino 101, the I2C data pin (SDA) is exposed as pin A4 (on the ANALOG IN
header) and the I2C clock pin (SCL) as pin A5 (also on the ANALOG IN header).
Since the Arduino 101 doesn’t have internal pull-up resistors, these need to be
added externally when connecting SCL and SDA to the sensors.</p>
<p>In addition to connecting the ground (GND), 3.3V power (VDD and VDDIO) and I2C
pins, both HDC1008 and BMP280 require some extra wiring.</p>
<p>For HDC1008, connect the address pins (A0 and A1) to GND (this sets the device
address to the default used by the app). Also connect the RDY pin of the sensor
to the A1 pin (on ANALOG IN header) of the Arduino board. This is needed as the
application configures data-ready interrupt on that pin (GPIO pin 3).</p>
<p>For BMP280, connect the SDO pin to GND and the CSB pin to VDDIO, since the
sensor needs to be setup to use I2C, and not SPI.</p>
<a class="reference internal image-reference" href="../../../../_images/wiring.png"><img alt="Wiring with Arduino 101" class="align-center" src="../../../../_images/wiring.png" style="width: 600px;" /></a>
</div>
<div class="section" id="using-board-sensors">
<h3>Using board sensors<a class="headerlink" href="#using-board-sensors" title="Permalink to this headline">¶</a></h3>
<p>If you do not want to use any external sensors, you can use the Arduino 101’s
internal BMI160 sensor to do just temperature readings. To do this, you need to
modify the channel_info array from the sensor subsystem application to contain
only BMI160’s temperature channel, and also remove the humidity and pressure
characteristic from the control application (running on the application
processor).</p>
<p>If you choose this approach and you also want to use the Grove LCD, then you
also need to modify the sensor subsystem application to only display temperature
on the LCD, as humidity and pressure values will not be available.</p>
</div>
<div class="section" id="grove-lcd">
<h3>Grove LCD<a class="headerlink" href="#grove-lcd" title="Permalink to this headline">¶</a></h3>
<p>Using the Grove LCD is optional and it can be disabled by removing the Grove
configuration options from the arc/proj.conf file.</p>
<p>The Grove LCD communicates with the sensor subsystem through the I2C bus. When
connecting the Grove LCD to the Arduino 101, either directly (similar to sensor
wiring) or through a Grove Base Shield, you need to make sure that the I2C SDA
and SCL lines have pull-up resistors connected between GND and the 3.3V power
source.</p>
<p>Take note that even though SDA and SCL are connected to a 3.3V power source, the
Grove LCD VDD line needs to be connected to the 5V power line, otherwise
characters will not be displayed on the LCD (3.3V is enough to power just the
backlight).</p>
</div>
</div>
<div class="section" id="building-and-running">
<h2>Building and Running<a class="headerlink" href="#building-and-running" title="Permalink to this headline">¶</a></h2>
<div class="section" id="building">
<h3>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h3>
<p>This sample builds two applications for both the sensor subsystem (arc) and the
application processor (x86). The resulting images need to be flashed to the
device either using JTAG (openocd) or DFU util (USB).</p>
<p>Before using the environmental sensing sample, the Arduino 101 board needs to be
flashed with the firmware for its nRF51 Bluetooth LE controller. To do this,
follow the steps in <a class="reference internal" href="../../../../boards/x86/arduino_101/doc/board.html#bluetooth-firmware-arduino-101"><span class="std std-ref">Flashing the Bluetooth Core</span></a>.</p>
<p>Build and flash each of the images either using JTAG or DFU (DFU is preferred):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> <span class="nv">$ZEPHYR_BASE</span>/samples/boards/arduino_101/environmental_sensing/ap
<span class="gp">$</span> mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
<span class="gp">$</span> cmake -DBOARD<span class="o">=</span>arduino_101 ..
<span class="gp">$</span> make
<span class="gp">$</span> make flash
</pre></div>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> <span class="nv">$ZEPHYR_BASE</span>/samples/boards/arduino_101/environmental_sensing/sensor
<span class="gp">$</span> mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
<span class="gp">$</span> cmake -DBOARD<span class="o">=</span>arduino_101_sss ..
<span class="gp">$</span> make
<span class="gp">$</span> make flash
</pre></div>
</div>
</div>
<div class="section" id="running">
<h3>Running<a class="headerlink" href="#running" title="Permalink to this headline">¶</a></h3>
<p>The ARC (Sensor Subsystem) program collects temperature, humidity and pressure
data using the sensors API and sends it to the x86 core through an outbound
IPM. The collected data is also displayed on a Grove LCD.</p>
<p>The x86 program reads the sensor data from an inbound IPM and exposes it as
GATT characteristics (temperature, humidity and pressure) through a simple
Bluetooth Environmental Sensing Service. The values of these characteristics
are updated every time a new message containing sensor data is received.</p>
<p>An example of sensor data values that can be seen on the Grove LCD is
illustrated in the image below.</p>
<a class="reference internal image-reference" href="../../../../_images/temp_sensing_4.png"><img alt="LCD Display" class="align-center" src="../../../../_images/temp_sensing_4.png" style="width: 400px;" /></a>
<p>The data exposed over Bluetooth using an Environmental Sensing Service can be
tested with a BLE Scanner app. The image below is a screenshot of such an application.</p>
<a class="reference internal image-reference" href="../../../../_images/temp_sensing_5.png"><img alt="BLE Scanner Application" class="align-center" src="../../../../_images/temp_sensing_5.png" style="width: 400px;" /></a>
<p>The temperature value is 0xBA09 (little-endian) which is equal to 2490 in
decimal. Since the Bluetooth specification states that temperature values are
expressed with a resolution of 0.01 degrees Celsius, the value exposed over
Bluetooth is the same as the one displayed on the Grove LCD (24.9 degrees
Celsius).</p>
</div>
</div>
</div>


                </div>
              </div>
              <!-- 
  <div class="rst-footer-buttons row" role="navigation" aria-label="footer navigation">
    
      <a href="../../microbit/display/README.html" class="btn btn-neutral float-right" title="BBC micro:bit display" accesskey="n">
        Next <span class="fa fa-arrow-circle-right"></span>
      </a>
    
    
      <a href="../arduino_101.html" class="btn btn-neutral" title="Arduino 101 Samples" accesskey="p">
        <span class="fa fa-arrow-circle-left"></span> Previous
      </a>
    
  </div>
  for ZEP-463 remove the prev/next links -->
            </div>
            <!-- ENDS #content SECTION -->
          </section>
          <!-- ENDS .content -->
        </div>
        <!-- ENDS .main-container -->
      </div>
      <!-- ENDS #main -->
      <footer id="footer">
  <div class="container">
    <div class="block block-menu block-odd first block" data-bid="menu-footer-menu">
      <h3 class="title">Footer Menu</h3>
      <ul class="menu">
        <li class="leaf google- mid-2404">
          <a href="https://plus.google.com/+ZephyrProject" class="google-plus"><span>Google+</span></a>
        </li>
        <li class="leaf twitter mid-2405">
          <a href="https://twitter.com/zephyriot" class="twitter"><span>Twitter</span></a>
        </li>
        <li class="last leaf email mid-2406">
          <a href="mailto:info@zephyrproject.org" class="email"><span>Email</span></a>
        </li>
      </ul>
    </div>
    <div class="block block-block block-even block" data-bid="block-4">
      <p>
        Zephyr Project © 2018 is a Linux Foundation Project. All Rights Reserved.
      </p>
      <p>
        <a href="https://linuxfoundation.org" target="_blank">Linux Foundation</a> is a registered trademark of The Linux Foundation. Linux is a registered <a href="https://www.linuxfoundation.org/about/linux-foundation-trademark-usage-guidelines" target="_blank">trademark</a> of Linus Torvalds.
      </p>
      <p>
        Please see our <a href="https://www.linuxfoundation.org/privacy" target="_blank">privacy policy</a> and <a href="https://www.linuxfoundation.org/terms" target="_blank">terms of use</a>
      </p>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #page -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.10.99',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/js/main.js"></script>
      <script type="text/javascript" src="../../../../_static/js/app.js"></script>
      <script type="text/javascript" src="../../../../_static/js/affix.js"></script>

   

  </body>
</html>