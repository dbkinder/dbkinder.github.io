

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" > <!--<![endif]-->
  <head>
    <meta charset="utf-8">
   <!-- Google Tag Manager -->
   <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
   new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
   j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
   })(window,document,'script','dataLayer','GTM-KMP8MS');</script>
   <!-- End Google Tag Manager -->
    <link rel="apple-touch-icon" sizes="57x57" href="../../_static/img/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../../_static/img/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../../_static/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../../_static/img/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../../_static/img/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../../_static/img/apple-touch-icon-120x120.png">
    <link rel="icon" type="image/png" href="../../_static/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../_static/img/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="../../_static/img/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="../../_static/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Zephyr Project">
    <meta name="application-name" content="Zephyr Project">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    
    <title>Polling API &mdash; Zephyr Project Documentation</title>
    

    
    

    

    
    
      
    

    
    
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    

    
      <link rel="stylesheet" href="../../_static/zephyr-custom.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/normalize.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/layout.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    

    
        <link rel="index" title="Index" href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
        <link rel="copyright" title="Copyright" href="../../copyright.html"/>
      <link rel="top" title="Zephyr Project Documentation" href="../../index.html"/>
        <link rel="up" title="Other Services" href="other.html"/>
        <link rel="next" title="Ring Buffers" href="ring_buffers.html"/>
        <link rel="prev" title="Atomic Services" href="atomic.html"/> 

    
    <script src="../../_static/js/modernizr.min.js"></script>

  </head>

  <body class="not-front page-documentation one-sidebar sidebar-first" role="document" >
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KMP8MS"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="page">
      <header id="header">
  <div class="header-wrapper">
    <div class="container">
      <a href="https://zephyrproject.org/" title="Zephyr Project" rel="home" id="logo">
        <img src="../../_static/img/logo_white.png" alt="Zephyr Project">
      </a>
      <a href="" id="navigation-toggle">
        <span> </span>
        Menu
      </a>
      <nav id="navigation" class="menu with-primary with-secondary">
        <ul class="header-menu main-menu">
          <li class="first expanded about mid-1209"><a href="https://zephyrproject.org/about/"><span>About</span></a>
            <ul class="menu">
              <li class="first leaf what-is-zephyr mid-2563"><a href="https://zephyrproject.org/what-is-zephyr/"><span>What is the Zephyr Project?</span></a></li>
              <li class="leaf organization mid-2564"><a href="https://zephyrproject.org/about/organization/"><span>Organization</span></a></li>
              <li class="leaf memberships mid-2532"><a href="https://zephyrproject.org/#members"><span>Members</span></a></li>
              <li class="leaf faq mid-2525"><a href="https://zephyrproject.org/about/#faq"><span>FAQ</span></a></li>
              <li class="leaf join mid-2622"><a href="https://zephyrproject.org/join/"><span>Join</span></a></li>
              <li class="last leaf contact-us mid-2530"><a href="https://zephyrproject.org/about/#contact-us"><span>Contact Us</span></a></li>
            </ul>
          </li>
          <li class="expanded developers mid-1209"><a href="https://zephyrproject.org/developers/"><span>Developers</span></a>
            <ul class="menu">
              <li class="first expanded leaf code mid-2563"><a href="https://github.com/zephyrproject-rtos/zephyr/" target="_blank"><span>Code</span></a></li>
              <li class="leaf downloads mid-2564"><a href="https://zephyrproject.org/developers/#downloads"><span>Downloads</span></a></li>
              <li class="leaf documentation mid-2564"><a href="http://docs.zephyrproject.org/index.html" target="_blank"><span>Documentation</span></a></li>
              <li class="leaf supported-boards mid-2564"><a href="http://docs.zephyrproject.org/boards/boards.html" target="_blank"><span>Supported Boards</span></a></li>
              <li class="leaf releases-overview mid-2564"><a href="https://zephyrproject.org/developers/#releases-overview"><span>Releases Overview</span></a></li>
              <li class="leaf how-to-contribute mid-2564"><a href="https://zephyrproject.org/developers/how-to-contribute/"><span>How to Contribute</span></a></li>
              <li class="last leaf community-guidelines mid-2564"><a href="https://zephyrproject.org/developers/how-to-contribute/#community-guidelines"><span>Community Guidelines</span></a></li>
            </ul>
          </li>
          <li class="expanded news mid-1209"><a href="https://zephyrproject.org/news/"><span>News</span></a>
            <ul class="menu">
              <li class="first leaf announcements mid-2563"><a href="https://zephyrproject.org/news/announcements/"><span>Announcements</span></a></li>
              <li class="leaf blog mid-2563"><a href="https://zephyrproject.org/news/blog/"><span>Blog</span></a></li>
              <li class="last leaf events mid-2563"><a href="https://zephyrproject.org/events/"><span>Events</span></a></li>
            </ul>
          </li>
          <li class="last expanded project-resources mid-1209"><a href="https://zephyrproject.org/project-resources/"><span>Project Resources</span></a>
            <ul class="menu">
              <li class="first leaf presentations mid-2563"><a href="https://zephyrproject.org/project-resources/presentations/"><span>Presentations</span></a></li>
              <li class="leaf videos mid-2563"><a href="https://zephyrproject.org/project-resources/videos/"><span>Videos</span></a></li>
              <li class="leaf demos mid-2563"><a href="https://zephyrproject.org/project-resources/demos/"><span>Demos</span></a></li>
              <li class="leaf zephyr-in-market mid-2563"><a href="https://zephyrproject.org/project-resources/zephyr-in-market/"><span>Zephyr in Market</span></a></li>
              <li class="last leaf developer-tools mid-2563"><a href="https://zephyrproject.org/project-resources/developer-tools/"><span>Developer Tools</span></a></li>
            </ul>
          </li>
        </ul>
      </nav><!-- /navigation -->
    </div>
  </div>
</header><!-- /header -->
      <!-- STARTS #main -->
      <div id="main">
        <!-- STARTS .main-container -->
        <div class="main-container">
          

 



<!-- Docs -->





<div id="breadcrumb">
  <div class="container">
    <a href="/">Home</a> / 
    <a href="../../index.html">Docs</a> /
      
          <a href="../kernel.html">Zephyr Kernel Primer</a> /
      
          <a href="other.html">Other Services</a> /
      
  </div>
</div>
          <aside id="sidebar-first" class="container-sidebar">
            
            <span id="secondary-menu-button" class="">Documentation</span>
<div class="region region-sidebar">
  <div class="docs-menu">
  
    
    
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introducing_zephyr.html">Introducing Zephyr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/contribute.html">Contributing to the Zephyr Project</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../kernel.html">Zephyr Kernel Primer</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../threads/threads.html">Threads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timing/timing.html">Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory/memory.html">Memory Allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../synchronization/synchronization.html">Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_passing/data_passing.html">Data Passing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usermode/usermode.html">User Mode</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="other.html">Other Services</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="interrupts.html">Interrupts</a></li>
<li class="toctree-l3"><a class="reference internal" href="atomic.html">Atomic Services</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Polling API</a></li>
<li class="toctree-l3"><a class="reference internal" href="ring_buffers.html">Ring Buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="float.html">Floating Point Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="cxx_support.html">C++ Support for Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpu_idle.html">CPU Idling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/security.html">Zephyr Project Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/boards.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devices/index.html">Device and Driver Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystems/subsystems.html">Subsystems</a></li>
</ul>

    
  
  </div>
<div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</div>
          </aside>
          <!-- STARTS .content SECTION-->
          <section id="content" class="row">
            
	    
            <div class="rst-content">
              <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                <div itemprop="articleBody">
                  
  <div class="section" id="polling-api">
<span id="polling-v2"></span><h1>Polling API<a class="headerlink" href="#polling-api" title="Permalink to this headline">¶</a></h1>
<p>The polling API is used to wait concurrently for any one of multiple conditions
to be fulfilled.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#concepts" id="id1">Concepts</a></li>
<li><a class="reference internal" href="#implementation" id="id2">Implementation</a><ul>
<li><a class="reference internal" href="#using-k-poll" id="id3">Using k_poll()</a></li>
<li><a class="reference internal" href="#using-k-poll-signal" id="id4">Using k_poll_signal()</a></li>
</ul>
</li>
<li><a class="reference internal" href="#suggested-uses" id="id5">Suggested Uses</a></li>
<li><a class="reference internal" href="#configuration-options" id="id6">Configuration Options</a></li>
<li><a class="reference internal" href="#apis" id="id7">APIs</a></li>
</ul>
</div>
<div class="section" id="concepts">
<h2><a class="toc-backref" href="#id1">Concepts</a><a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h2>
<p>The polling API’s main function is <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a>, which is very similar
in concept to the POSIX <code class="xref cpp cpp-func docutils literal"><span class="pre">poll()</span></code> function, except that it operates on
kernel objects rather than on file descriptors.</p>
<p>The polling API allows a single thread to wait concurrently for one or more
conditions to be fulfilled without actively looking at each one individually.</p>
<p>There is a limited set of such conditions:</p>
<ul class="simple">
<li>a semaphore becomes available</li>
<li>a kernel FIFO contains data ready to be retrieved</li>
<li>a poll signal is raised</li>
</ul>
<p>A thread that wants to wait on multiple conditions must define an array of
<strong>poll events</strong>, one for each condition.</p>
<p>All events in the array must be initialized before the array can be polled on.</p>
<p>Each event must specify which <strong>type</strong> of condition must be satisfied so that
its state is changed to signal the requested condition has been met.</p>
<p>Each event must specify what <strong>kernel object</strong> it wants the condition to be
satisfied.</p>
<p>Each event must specify which <strong>mode</strong> of operation is used when the condition
is satisfied.</p>
<p>Each event can optionally specify a <strong>tag</strong> to group multiple events together,
to the user’s discretion.</p>
<p>Apart from the kernel objects, there is also a <strong>poll signal</strong> pseudo-object
type that be directly signaled.</p>
<p>The <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> function returns as soon as one of the conditions it
is waiting for is fulfilled. It is possible for more than one to be fulfilled
when <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> returns, if they were fulfilled before
<a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> was called, or due to the preemptive multi-threading
nature of the kernel. The caller must look at the state of all the poll events
in the array to figured out which ones were fulfilled and what actions to take.</p>
<p>Currently, there is only one mode of operation available: the object is not
acquired. As an example, this means that when <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> returns and
the poll event states that the semaphore is available, the caller of
<a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> must then invoke <a class="reference internal" href="../../api/kernel_api.html#_CPPv210k_sem_takeP5k_sem5s32_t" title="k_sem_take"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_sem_take()</span></code></a> to take
ownership of the semaphore. If the semaphore is contested, there is no
guarantee that it will be still available when <a class="reference internal" href="../../api/kernel_api.html#_CPPv210k_sem_giveP5k_sem" title="k_sem_give"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_sem_give()</span></code></a> is
called.</p>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id2">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-k-poll">
<h3><a class="toc-backref" href="#id3">Using k_poll()</a><a class="headerlink" href="#using-k-poll" title="Permalink to this headline">¶</a></h3>
<p>The main API is <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a>, which operates on an array of poll events
of type <code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">k_poll_event</span></code>. Each entry in the array represents one
event a call to <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> will wait for its condition to be
fulfilled.</p>
<p>They can be initialized using either the runtime initializers
<code class="xref c c-macro docutils literal"><span class="pre">K_POLL_EVENT_INITIALIZER()</span></code> or <a class="reference internal" href="../../api/kernel_api.html#_CPPv217k_poll_event_initP12k_poll_event5u32_tiPv" title="k_poll_event_init"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll_event_init()</span></code></a>, or
the static initializer <code class="xref c c-macro docutils literal"><span class="pre">K_POLL_EVENT_STATIC_INITIALIZER()</span></code>. An object
that matches the <strong>type</strong> specified must be passed to the initializers. The
<strong>mode</strong> <em>must</em> be set to <code class="xref c c-macro docutils literal"><span class="pre">K_POLL_MODE_NOTIFY_ONLY</span></code>. The state <em>must</em>
be set to <a class="reference internal" href="../../api/kernel_api.html#c.K_POLL_STATE_NOT_READY" title="K_POLL_STATE_NOT_READY"><code class="xref c c-macro docutils literal"><span class="pre">K_POLL_STATE_NOT_READY</span></code></a> (the initializers take care of
this). The user <strong>tag</strong> is optional and completely opaque to the API: it is
there to help a user to group similar events together. Being optional, it is
passed to the static initializer, but not the runtime ones for performance
reasons. If using runtime initializers, the user must set it separately in the
<code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">k_poll_event</span></code> data structure. If an event in the array is to be
ignored, most likely temporarily, its type can be set to K_POLL_TYPE_IGNORE.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">k_poll_event</span> <span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">K_POLL_EVENT_STATIC_INITIALIZER</span><span class="p">(</span><span class="n">K_POLL_TYPE_SEM_AVAILABLE</span><span class="p">,</span>
                                    <span class="n">K_POLL_MODE_NOTIFY_ONLY</span><span class="p">,</span>
                                    <span class="o">&amp;</span><span class="n">my_sem</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">K_POLL_EVENT_STATIC_INITIALIZER</span><span class="p">(</span><span class="n">K_POLL_TYPE_FIFO_DATA_AVAILABLE</span><span class="p">,</span>
                                    <span class="n">K_POLL_MODE_NOTIFY_ONLY</span><span class="p">,</span>
                                    <span class="o">&amp;</span><span class="n">my_fifo</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>
</pre></div>
</div>
<p>or at runtime</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">k_poll_event</span> <span class="n">events</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="kt">void</span> <span class="nf">some_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">k_poll_event_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">K_POLL_TYPE_SEM_AVAILABLE</span><span class="p">,</span>
                      <span class="n">K_POLL_MODE_NOTIFY_ONLY</span><span class="p">,</span>
                      <span class="o">&amp;</span><span class="n">my_sem</span><span class="p">);</span>

    <span class="n">k_poll_event_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">K_POLL_TYPE_FIFO_DATA_AVAILABLE</span><span class="p">,</span>
                      <span class="n">K_POLL_MODE_NOTIFY_ONLY</span><span class="p">,</span>
                      <span class="o">&amp;</span><span class="n">my_fifo</span><span class="p">);</span>

    <span class="c1">// tags are left uninitialized if unused</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After the events are initialized, the array can be passed to
<a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a>. A timeout can be specified to wait only for a specified
amount of time, or the special values <a class="reference internal" href="../../api/kernel_api.html#c.K_NO_WAIT" title="K_NO_WAIT"><code class="xref c c-macro docutils literal"><span class="pre">K_NO_WAIT</span></code></a> and
<a class="reference internal" href="../../api/kernel_api.html#c.K_FOREVER" title="K_FOREVER"><code class="xref c c-macro docutils literal"><span class="pre">K_FOREVER</span></code></a> to either not wait or wait until an event condition is
satisfied and not sooner.</p>
<p>Only one thread can poll on a semaphore or a FIFO at a time. If a second thread
tries to poll on the same semaphore or FIFO, <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> immediately
returns with the return value <code class="xref c c-macro docutils literal"><span class="pre">-EADDRINUSE</span></code>. In that case, if other
conditions passed to <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> were met, their state will be set in
the corresponding poll event.</p>
<p>In case of success, <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> returns 0. If it times out, it returns
<code class="xref c c-macro docutils literal"><span class="pre">-EAGAIN</span></code>.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="c1">// assume there is no contention on this semaphore and FIFO</span>
<span class="c1">// -EADDRINUSE will not occur; the semaphore and/or data will be available</span>

<span class="kt">void</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">k_poll</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">state</span> <span class="o">==</span> <span class="n">K_POLL_STATE_SEM_AVAILABLE</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">k_sem_take</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">sem</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">state</span> <span class="o">==</span> <span class="n">K_POLL_STATE_FIFO_DATA_AVAILABLE</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">k_fifo_get</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">fifo</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="c1">// handle data</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// handle timeout</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> is called in a loop, the events state must be reset
to <a class="reference internal" href="../../api/kernel_api.html#c.K_POLL_STATE_NOT_READY" title="K_POLL_STATE_NOT_READY"><code class="xref c c-macro docutils literal"><span class="pre">K_POLL_STATE_NOT_READY</span></code></a> by the user.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span><span class="p">(;;)</span> <span class="p">{</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">k_poll</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">K_FOREVER</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">state</span> <span class="o">==</span> <span class="n">K_POLL_STATE_SEM_AVAILABLE</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">k_sem_take</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">sem</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">state</span> <span class="o">==</span> <span class="n">K_POLL_STATE_FIFO_DATA_AVAILABLE</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">k_fifo_get</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">fifo</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="c1">// handle data</span>
        <span class="p">}</span>
        <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">state</span> <span class="o">=</span> <span class="n">K_POLL_STATE_NOT_READY</span><span class="p">;</span>
        <span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">state</span> <span class="o">=</span> <span class="n">K_POLL_STATE_NOT_READY</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="using-k-poll-signal">
<h3><a class="toc-backref" href="#id4">Using k_poll_signal()</a><a class="headerlink" href="#using-k-poll-signal" title="Permalink to this headline">¶</a></h3>
<p>One of the types of events is <a class="reference internal" href="../../api/kernel_api.html#c.K_POLL_TYPE_SIGNAL" title="K_POLL_TYPE_SIGNAL"><code class="xref c c-macro docutils literal"><span class="pre">K_POLL_TYPE_SIGNAL</span></code></a>: this is a “direct”
signal to a poll event. This can be seen as a lightweight binary semaphore only
one thread can wait for.</p>
<p>A poll signal is a separate object of type <code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">k_poll_signal</span></code> that
must be attached to a k_poll_event, similar to a semaphore or FIFO. It must
first be initialized either via <code class="xref c c-macro docutils literal"><span class="pre">K_POLL_SIGNAL_INITIALIZER()</span></code> or
<a class="reference internal" href="../../api/kernel_api.html#_CPPv218k_poll_signal_initP13k_poll_signal" title="k_poll_signal_init"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll_signal_init()</span></code></a>.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">k_poll_signal</span> <span class="n">signal</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">k_poll_signal_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">signal</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is signaled via the <a class="reference internal" href="../../api/kernel_api.html#_CPPv213k_poll_signalP13k_poll_signali" title="k_poll_signal"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll_signal()</span></code></a> function. This function
takes a user <strong>result</strong> parameter that is opaque to the API and can be used to
pass extra information to the thread waiting on the event.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">k_poll_signal</span> <span class="n">signal</span><span class="p">;</span>

<span class="c1">// thread A</span>
<span class="kt">void</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">k_poll_signal_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">signal</span><span class="p">);</span>

    <span class="k">struct</span> <span class="n">k_poll_event</span> <span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">K_POLL_EVENT_INITIALIZER</span><span class="p">(</span><span class="n">K_POLL_TYPE_SIGNAL</span><span class="p">,</span>
                                 <span class="n">K_POLL_MODE_NOTIFY_ONLY</span><span class="p">,</span>
                                 <span class="o">&amp;</span><span class="n">signal</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="n">k_poll</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">K_FOREVER</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">events</span><span class="p">.</span><span class="n">signal</span><span class="o">-&gt;</span><span class="n">result</span> <span class="o">==</span> <span class="mh">0x1337</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// A-OK!</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// weird error</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// thread B</span>
<span class="kt">void</span> <span class="nf">signal_do_stuff</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">k_poll_signal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">signal</span><span class="p">,</span> <span class="mh">0x1337</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the signal is to be polled in a loop, <em>both</em> its event state and its
<strong>signaled</strong> field <em>must</em> be reset on each iteration if it has been signaled.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">k_poll_signal</span> <span class="n">signal</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">k_poll_signal_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">signal</span><span class="p">);</span>

    <span class="k">struct</span> <span class="n">k_poll_event</span> <span class="n">events</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">K_POLL_EVENT_INITIALIZER</span><span class="p">(</span><span class="n">K_POLL_TYPE_SIGNAL</span><span class="p">,</span>
                                 <span class="n">K_POLL_MODE_NOTIFY_ONLY</span><span class="p">,</span>
                                 <span class="o">&amp;</span><span class="n">signal</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
        <span class="n">k_poll</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">K_FOREVER</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">signal</span><span class="o">-&gt;</span><span class="n">result</span> <span class="o">==</span> <span class="mh">0x1337</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// A-OK!</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// weird error</span>
        <span class="p">}</span>

        <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">signal</span><span class="o">-&gt;</span><span class="n">signaled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">state</span> <span class="o">=</span> <span class="n">K_POLL_STATE_NOT_READY</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="suggested-uses">
<h2><a class="toc-backref" href="#id5">Suggested Uses</a><a class="headerlink" href="#suggested-uses" title="Permalink to this headline">¶</a></h2>
<p>Use <a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a> to consolidate multiple threads that would be pending
on one object each, saving possibly large amounts of stack space.</p>
<p>Use a poll signal as a lightweight binary semaphore if only one thread pends on
it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because objects are only signaled if no other thread is waiting for them to
become available and only one thread can poll on a specific object, polling
is best used when objects are not subject of contention between multiple
threads, basically when a single thread operates as a main “server” or
“dispatcher” for multiple objects and is the only one trying to acquire
these objects.</p>
</div>
</div>
<div class="section" id="configuration-options">
<h2><a class="toc-backref" href="#id6">Configuration Options</a><a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h2>
<p>Related configuration options:</p>
<ul class="simple">
<li><a class="reference internal" href="../../reference/kconfig/CONFIG_POLL.html#cmdoption-arg-config-poll"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_POLL</span></code></a></li>
</ul>
</div>
<div class="section" id="apis">
<h2><a class="toc-backref" href="#id7">APIs</a><a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h2>
<p>The following polling APIs are provided by <code class="file docutils literal"><span class="pre">kernel.h</span></code>:</p>
<ul class="simple">
<li><a class="reference internal" href="../../api/kernel_api.html#c.K_POLL_EVENT_INITIALIZER" title="K_POLL_EVENT_INITIALIZER"><code class="xref c c-macro docutils literal"><span class="pre">K_POLL_EVENT_INITIALIZER</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#c.K_POLL_EVENT_STATIC_INITIALIZER" title="K_POLL_EVENT_STATIC_INITIALIZER"><code class="xref c c-macro docutils literal"><span class="pre">K_POLL_EVENT_STATIC_INITIALIZER</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv217k_poll_event_initP12k_poll_event5u32_tiPv" title="k_poll_event_init"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll_event_init()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv26k_pollP12k_poll_eventi5s32_t" title="k_poll"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv218k_poll_signal_initP13k_poll_signal" title="k_poll_signal_init"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll_signal_init()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv213k_poll_signalP13k_poll_signali" title="k_poll_signal"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_poll_signal()</span></code></a></li>
</ul>
</div>
</div>


                </div>
              </div>
              <!-- 
  <div class="rst-footer-buttons row" role="navigation" aria-label="footer navigation">
    
      <a href="ring_buffers.html" class="btn btn-neutral float-right" title="Ring Buffers" accesskey="n">
        Next <span class="fa fa-arrow-circle-right"></span>
      </a>
    
    
      <a href="atomic.html" class="btn btn-neutral" title="Atomic Services" accesskey="p">
        <span class="fa fa-arrow-circle-left"></span> Previous
      </a>
    
  </div>
  for ZEP-463 remove the prev/next links -->
            </div>
            <!-- ENDS #content SECTION -->
          </section>
          <!-- ENDS .content -->
        </div>
        <!-- ENDS .main-container -->
      </div>
      <!-- ENDS #main -->
      <footer id="footer">
  <div class="container">
    <div class="block block-menu block-odd first block" data-bid="menu-footer-menu">
      <h3 class="title">Footer Menu</h3>
      <ul class="menu">
        <li class="leaf google- mid-2404">
          <a href="https://plus.google.com/+ZephyrProject" class="google-plus"><span>Google+</span></a>
        </li>
        <li class="leaf twitter mid-2405">
          <a href="https://twitter.com/zephyriot" class="twitter"><span>Twitter</span></a>
        </li>
        <li class="last leaf email mid-2406">
          <a href="mailto:info@zephyrproject.org" class="email"><span>Email</span></a>
        </li>
      </ul>
    </div>
    <div class="block block-block block-even block" data-bid="block-4">
      <p>
        Zephyr Project © 2018 is a Linux Foundation Project. All Rights Reserved.
      </p>
      <p>
        <a href="https://linuxfoundation.org" target="_blank">Linux Foundation</a> is a registered trademark of The Linux Foundation. Linux is a registered <a href="https://www.linuxfoundation.org/about/linux-foundation-trademark-usage-guidelines" target="_blank">trademark</a> of Linus Torvalds.
      </p>
      <p>
        Please see our <a href="https://www.linuxfoundation.org/privacy" target="_blank">privacy policy</a> and <a href="https://www.linuxfoundation.org/terms" target="_blank">terms of use</a>
      </p>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #page -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.10.99',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/js/main.js"></script>
      <script type="text/javascript" src="../../_static/js/app.js"></script>
      <script type="text/javascript" src="../../_static/js/affix.js"></script>

   

  </body>
</html>