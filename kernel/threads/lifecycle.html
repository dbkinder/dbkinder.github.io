

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" > <!--<![endif]-->
  <head>
    <meta charset="utf-8">
   <!-- Google Tag Manager -->
   <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
   new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
   j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
   })(window,document,'script','dataLayer','GTM-KMP8MS');</script>
   <!-- End Google Tag Manager -->
    <link rel="apple-touch-icon" sizes="57x57" href="../../_static/img/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../../_static/img/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../../_static/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../../_static/img/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../../_static/img/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../../_static/img/apple-touch-icon-120x120.png">
    <link rel="icon" type="image/png" href="../../_static/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../_static/img/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="../../_static/img/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="../../_static/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Zephyr Project">
    <meta name="application-name" content="Zephyr Project">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    
    <title>Lifecycle &mdash; Zephyr Project Documentation</title>
    

    
    

    

    
    
      
    

    
    
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    

    
      <link rel="stylesheet" href="../../_static/zephyr-custom.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/normalize.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/layout.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    

    
        <link rel="index" title="Index" href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
        <link rel="copyright" title="Copyright" href="../../copyright.html"/>
      <link rel="top" title="Zephyr Project Documentation" href="../../index.html"/>
        <link rel="up" title="Threads" href="threads.html"/>
        <link rel="next" title="Scheduling" href="scheduling.html"/>
        <link rel="prev" title="Threads" href="threads.html"/> 

    
    <script src="../../_static/js/modernizr.min.js"></script>

  </head>

  <body class="not-front page-documentation one-sidebar sidebar-first" role="document" >
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KMP8MS"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="page">
      <header id="header">
  <div class="header-wrapper">
    <div class="container">
      <a href="https://zephyrproject.org/" title="Zephyr Project" rel="home" id="logo">
        <img src="../../_static/img/logo_white.png" alt="Zephyr Project">
      </a>
      <a href="" id="navigation-toggle">
        <span> </span>
        Menu
      </a>
      <nav id="navigation" class="menu with-primary with-secondary">
        <ul class="header-menu main-menu">
          <li class="first expanded about mid-1209"><a href="https://zephyrproject.org/about/"><span>About</span></a>
            <ul class="menu">
              <li class="first leaf what-is-zephyr mid-2563"><a href="https://zephyrproject.org/what-is-zephyr/"><span>What is the Zephyr Project?</span></a></li>
              <li class="leaf organization mid-2564"><a href="https://zephyrproject.org/about/organization/"><span>Organization</span></a></li>
              <li class="leaf memberships mid-2532"><a href="https://zephyrproject.org/#members"><span>Members</span></a></li>
              <li class="leaf faq mid-2525"><a href="https://zephyrproject.org/about/#faq"><span>FAQ</span></a></li>
              <li class="leaf join mid-2622"><a href="https://zephyrproject.org/join/"><span>Join</span></a></li>
              <li class="last leaf contact-us mid-2530"><a href="https://zephyrproject.org/about/#contact-us"><span>Contact Us</span></a></li>
            </ul>
          </li>
          <li class="expanded developers mid-1209"><a href="https://zephyrproject.org/developers/"><span>Developers</span></a>
            <ul class="menu">
              <li class="first expanded leaf code mid-2563"><a href="https://github.com/zephyrproject-rtos/zephyr/" target="_blank"><span>Code</span></a></li>
              <li class="leaf downloads mid-2564"><a href="https://zephyrproject.org/developers/#downloads"><span>Downloads</span></a></li>
              <li class="leaf documentation mid-2564"><a href="http://docs.zephyrproject.org/index.html" target="_blank"><span>Documentation</span></a></li>
              <li class="leaf supported-boards mid-2564"><a href="http://docs.zephyrproject.org/boards/boards.html" target="_blank"><span>Supported Boards</span></a></li>
              <li class="leaf releases-overview mid-2564"><a href="https://zephyrproject.org/developers/#releases-overview"><span>Releases Overview</span></a></li>
              <li class="leaf how-to-contribute mid-2564"><a href="https://zephyrproject.org/developers/how-to-contribute/"><span>How to Contribute</span></a></li>
              <li class="last leaf community-guidelines mid-2564"><a href="https://zephyrproject.org/developers/how-to-contribute/#community-guidelines"><span>Community Guidelines</span></a></li>
            </ul>
          </li>
          <li class="expanded news mid-1209"><a href="https://zephyrproject.org/news/"><span>News</span></a>
            <ul class="menu">
              <li class="first leaf announcements mid-2563"><a href="https://zephyrproject.org/news/announcements/"><span>Announcements</span></a></li>
              <li class="leaf blog mid-2563"><a href="https://zephyrproject.org/news/blog/"><span>Blog</span></a></li>
              <li class="last leaf events mid-2563"><a href="https://zephyrproject.org/events/"><span>Events</span></a></li>
            </ul>
          </li>
          <li class="last expanded project-resources mid-1209"><a href="https://zephyrproject.org/project-resources/"><span>Project Resources</span></a>
            <ul class="menu">
              <li class="first leaf presentations mid-2563"><a href="https://zephyrproject.org/project-resources/presentations/"><span>Presentations</span></a></li>
              <li class="leaf videos mid-2563"><a href="https://zephyrproject.org/project-resources/videos/"><span>Videos</span></a></li>
              <li class="leaf demos mid-2563"><a href="https://zephyrproject.org/project-resources/demos/"><span>Demos</span></a></li>
              <li class="leaf zephyr-in-market mid-2563"><a href="https://zephyrproject.org/project-resources/zephyr-in-market/"><span>Zephyr in Market</span></a></li>
              <li class="last leaf developer-tools mid-2563"><a href="https://zephyrproject.org/project-resources/developer-tools/"><span>Developer Tools</span></a></li>
            </ul>
          </li>
        </ul>
      </nav><!-- /navigation -->
    </div>
  </div>
</header><!-- /header -->
      <!-- STARTS #main -->
      <div id="main">
        <!-- STARTS .main-container -->
        <div class="main-container">
          

 



<!-- Docs -->





<div id="breadcrumb">
  <div class="container">
    <a href="/">Home</a> / 
    <a href="../../index.html">Docs</a> /
      
          <a href="../kernel.html">Zephyr Kernel Primer</a> /
      
          <a href="threads.html">Threads</a> /
      
  </div>
</div>
          <aside id="sidebar-first" class="container-sidebar">
            
            <span id="secondary-menu-button" class="">Documentation</span>
<div class="region region-sidebar">
  <div class="docs-menu">
  
    
    
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introducing_zephyr.html">Introducing Zephyr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/contribute.html">Contributing to the Zephyr Project</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../kernel.html">Zephyr Kernel Primer</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="threads.html">Threads</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Lifecycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="scheduling.html">Scheduling</a></li>
<li class="toctree-l3"><a class="reference internal" href="custom_data.html">Custom Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="system_threads.html">System Threads</a></li>
<li class="toctree-l3"><a class="reference internal" href="workqueues.html">Workqueue Threads</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../timing/timing.html">Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory/memory.html">Memory Allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../synchronization/synchronization.html">Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_passing/data_passing.html">Data Passing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usermode/usermode.html">User Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/other.html">Other Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/security.html">Zephyr Project Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/boards.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devices/index.html">Device and Driver Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystems/subsystems.html">Subsystems</a></li>
</ul>

    
  
  </div>
<div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</div>
          </aside>
          <!-- STARTS .content SECTION-->
          <section id="content" class="row">
            
	    
            <div class="rst-content">
              <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                <div itemprop="articleBody">
                  
  <div class="section" id="lifecycle">
<span id="lifecycle-v2"></span><h1>Lifecycle<a class="headerlink" href="#lifecycle" title="Permalink to this headline">¶</a></h1>
<p>A <em class="dfn">thread</em> is a kernel object that is used for application processing
that is too lengthy or too complex to be performed by an ISR.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#concepts" id="id1">Concepts</a><ul>
<li><a class="reference internal" href="#thread-creation" id="id2">Thread Creation</a></li>
<li><a class="reference internal" href="#thread-termination" id="id3">Thread Termination</a></li>
<li><a class="reference internal" href="#thread-aborting" id="id4">Thread Aborting</a></li>
<li><a class="reference internal" href="#thread-suspension" id="id5">Thread Suspension</a></li>
<li><a class="reference internal" href="#thread-options" id="id6">Thread Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation" id="id7">Implementation</a><ul>
<li><a class="reference internal" href="#spawning-a-thread" id="id8">Spawning a Thread</a></li>
<li><a class="reference internal" href="#dropping-permissions" id="id9">Dropping Permissions</a></li>
<li><a class="reference internal" href="#terminating-a-thread" id="id10">Terminating a Thread</a></li>
</ul>
</li>
<li><a class="reference internal" href="#suggested-uses" id="id11">Suggested Uses</a></li>
<li><a class="reference internal" href="#configuration-options" id="id12">Configuration Options</a></li>
<li><a class="reference internal" href="#apis" id="id13">APIs</a></li>
</ul>
</div>
<div class="section" id="concepts">
<h2><a class="toc-backref" href="#id1">Concepts</a><a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h2>
<p>Any number of threads can be defined by an application. Each thread is
referenced by a <em class="dfn">thread id</em> that is assigned when the thread is spawned.</p>
<p>A thread has the following key properties:</p>
<ul class="simple">
<li>A <strong>stack area</strong>, which is a region of memory used for the thread’s stack.
The <strong>size</strong> of the stack area can be tailored to conform to the actual needs
of the thread’s processing. Special macros exist to create and work with
stack memory regions.</li>
<li>A <strong>thread control block</strong> for private kernel bookkeeping of the thread’s
metadata. This is an instance of type <code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">k_thread</span></code>.</li>
<li>An <strong>entry point function</strong>, which is invoked when the thread is started.
Up to 3 <strong>argument values</strong> can be passed to this function.</li>
<li>A <strong>scheduling priority</strong>, which instructs the kernel’s scheduler how to
allocate CPU time to the thread. (See <a class="reference internal" href="scheduling.html#scheduling-v2"><span class="std std-ref">Scheduling</span></a>.)</li>
<li>A set of <strong>thread options</strong>, which allow the thread to receive special
treatment by the kernel under specific circumstances.
(See <a class="reference internal" href="#thread-options-v2"><span class="std std-ref">Thread Options</span></a>.)</li>
<li>A <strong>start delay</strong>, which specifies how long the kernel should wait before
starting the thread.</li>
<li>An <strong>execution mode</strong>, which can either be supervisor or user mode.
By default, threads run in supervisor mode and allow access to
privileged CPU instructions, the entire memory address space, and
peripherals. User mode threads have a reduced set of privileges.
This depends on the <a class="reference internal" href="../../reference/kconfig/CONFIG_USERSPACE.html#cmdoption-arg-config-userspace"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_USERSPACE</span></code></a> option. See <a class="reference internal" href="../usermode/usermode.html#usermode"><span class="std std-ref">User Mode</span></a>.</li>
</ul>
<div class="section" id="thread-creation">
<span id="spawning-thread"></span><h3><a class="toc-backref" href="#id2">Thread Creation</a><a class="headerlink" href="#thread-creation" title="Permalink to this headline">¶</a></h3>
<p>A thread must be created before it can be used. The kernel initializes
the thread control block as well as one end of the stack portion. The remainder
of the thread’s stack is typically left uninitialized.</p>
<p>Specifying a start delay of <a class="reference internal" href="../../api/kernel_api.html#c.K_NO_WAIT" title="K_NO_WAIT"><code class="xref c c-macro docutils literal"><span class="pre">K_NO_WAIT</span></code></a> instructs the kernel
to start thread execution immediately. Alternatively, the kernel can be
instructed to delay execution of the thread by specifying a timeout
value – for example, to allow device hardware used by the thread
to become available.</p>
<p>The kernel allows a delayed start to be canceled before the thread begins
executing. A cancellation request has no effect if the thread has already
started. A thread whose delayed start was successfully canceled must be
re-spawned before it can be used.</p>
</div>
<div class="section" id="thread-termination">
<h3><a class="toc-backref" href="#id3">Thread Termination</a><a class="headerlink" href="#thread-termination" title="Permalink to this headline">¶</a></h3>
<p>Once a thread is started it typically executes forever. However, a thread may
synchronously end its execution by returning from its entry point function.
This is known as <strong>termination</strong>.</p>
<p>A thread that terminates is responsible for releasing any shared resources
it may own (such as mutexes and dynamically allocated memory)
prior to returning, since the kernel does <em>not</em> reclaim them automatically.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The kernel does not currently make any claims regarding an application’s
ability to respawn a thread that terminates.</p>
</div>
</div>
<div class="section" id="thread-aborting">
<h3><a class="toc-backref" href="#id4">Thread Aborting</a><a class="headerlink" href="#thread-aborting" title="Permalink to this headline">¶</a></h3>
<p>A thread may asynchronously end its execution by <strong>aborting</strong>. The kernel
automatically aborts a thread if the thread triggers a fatal error condition,
such as dereferencing a null pointer.</p>
<p>A thread can also be aborted by another thread (or by itself)
by calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv214k_thread_abort7k_tid_t" title="k_thread_abort"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_thread_abort()</span></code></a>. However, it is typically preferable
to signal a thread to terminate itself gracefully, rather than aborting it.</p>
<p>As with thread termination, the kernel does not reclaim shared resources
owned by an aborted thread.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The kernel does not currently make any claims regarding an application’s
ability to respawn a thread that aborts.</p>
</div>
</div>
<div class="section" id="thread-suspension">
<h3><a class="toc-backref" href="#id5">Thread Suspension</a><a class="headerlink" href="#thread-suspension" title="Permalink to this headline">¶</a></h3>
<p>A thread can be prevented from executing for an indefinite period of time
if it becomes <strong>suspended</strong>. The function <a class="reference internal" href="../../api/kernel_api.html#_CPPv216k_thread_suspend7k_tid_t" title="k_thread_suspend"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_thread_suspend()</span></code></a>
can be used to suspend any thread, including the calling thread.
Suspending a thread that is already suspended has no additional effect.</p>
<p>Once suspended, a thread cannot be scheduled until another thread calls
<a class="reference internal" href="../../api/kernel_api.html#_CPPv215k_thread_resume7k_tid_t" title="k_thread_resume"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_thread_resume()</span></code></a> to remove the suspension.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A thread can prevent itself from executing for a specified period of time
using <a class="reference internal" href="../../api/kernel_api.html#_CPPv27k_sleep5s32_t" title="k_sleep"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_sleep()</span></code></a>. However, this is different from suspending
a thread since a sleeping thread becomes executable automatically when the
time limit is reached.</p>
</div>
</div>
<div class="section" id="thread-options">
<span id="thread-options-v2"></span><h3><a class="toc-backref" href="#id6">Thread Options</a><a class="headerlink" href="#thread-options" title="Permalink to this headline">¶</a></h3>
<p>The kernel supports a small set of <em class="dfn">thread options</em> that allow a thread
to receive special treatment under specific circumstances. The set of options
associated with a thread are specified when the thread is spawned.</p>
<p>A thread that does not require any thread option has an option value of zero.
A thread that requires a thread option specifies it by name, using the
<code class="docutils literal"><span class="pre">|</span></code> character as a separator if multiple options are needed
(i.e. combine options using the bitwise OR operator).</p>
<p>The following thread options are supported.</p>
<dl class="docutils">
<dt><a class="reference internal" href="../../api/kernel_api.html#c.K_ESSENTIAL" title="K_ESSENTIAL"><code class="xref c c-macro docutils literal"><span class="pre">K_ESSENTIAL</span></code></a></dt>
<dd><p class="first">This option tags the thread as an <em class="dfn">essential thread</em>. This instructs
the kernel to treat the termination or aborting of the thread as a fatal
system error.</p>
<p class="last">By default, the thread is not considered to be an essential thread.</p>
</dd>
<dt><code class="xref c c-macro docutils literal"><span class="pre">K_FP_REGS</span></code> and <code class="xref c c-macro docutils literal"><span class="pre">K_SSE_REGS</span></code></dt>
<dd><p class="first">These x86-specific options indicate that the thread uses the CPU’s
floating point registers and SSE registers, respectively. This instructs
the kernel to take additional steps to save and restore the contents
of these registers when scheduling the thread.
(For more information see <a class="reference internal" href="../other/float.html#float-v2"><span class="std std-ref">Floating Point Services</span></a>.)</p>
<p class="last">By default, the kernel does not attempt to save and restore the contents
of these registers when scheduling the thread.</p>
</dd>
<dt><a class="reference internal" href="../../api/kernel_api.html#c.K_USER" title="K_USER"><code class="xref c c-macro docutils literal"><span class="pre">K_USER</span></code></a></dt>
<dd>If <a class="reference internal" href="../../reference/kconfig/CONFIG_USERSPACE.html#cmdoption-arg-config-userspace"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_USERSPACE</span></code></a> is enabled, this thread will be created in
user mode and will have reduced privileges. See <a class="reference internal" href="../usermode/usermode.html#usermode"><span class="std std-ref">User Mode</span></a>. Otherwise
this flag does nothing.</dd>
<dt><a class="reference internal" href="../../api/kernel_api.html#c.K_INHERIT_PERMS" title="K_INHERIT_PERMS"><code class="xref c c-macro docutils literal"><span class="pre">K_INHERIT_PERMS</span></code></a></dt>
<dd>If <a class="reference internal" href="../../reference/kconfig/CONFIG_USERSPACE.html#cmdoption-arg-config-userspace"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_USERSPACE</span></code></a> is enabled, this thread will inherit all
kernel object permissions that the parent thread had, except the parent
thread object.  See <a class="reference internal" href="../usermode/usermode.html#usermode"><span class="std std-ref">User Mode</span></a>.</dd>
</dl>
</div>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id7">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="spawning-a-thread">
<h3><a class="toc-backref" href="#id8">Spawning a Thread</a><a class="headerlink" href="#spawning-a-thread" title="Permalink to this headline">¶</a></h3>
<p>A thread is spawned by defining its stack area and its thread control block,
and then calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv215k_thread_createP8k_threadP16k_thread_stack_t6size_t16k_thread_entry_tPvPvPvi5u32_t5s32_t" title="k_thread_create"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_thread_create()</span></code></a>. The stack area must be defined
using <code class="xref c c-macro docutils literal"><span class="pre">K_THREAD_STACK_DEFINE</span></code> to ensure it is properly set up in
memory.</p>
<p>The thread spawning function returns its thread id, which can be used
to reference the thread.</p>
<p>The following code spawns a thread that starts immediately.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define MY_STACK_SIZE 500</span>
<span class="cp">#define MY_PRIORITY 5</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="nf">my_entry_point</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>

<span class="n">K_THREAD_STACK_DEFINE</span><span class="p">(</span><span class="n">my_stack_area</span><span class="p">,</span> <span class="n">MY_STACK_SIZE</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">k_thread</span> <span class="n">my_thread_data</span><span class="p">;</span>

<span class="n">k_tid_t</span> <span class="n">my_tid</span> <span class="o">=</span> <span class="n">k_thread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_thread_data</span><span class="p">,</span> <span class="n">my_stack_area</span><span class="p">,</span>
                                 <span class="n">K_THREAD_STACK_SIZEOF</span><span class="p">(</span><span class="n">my_stack_area</span><span class="p">),</span>
                                 <span class="n">my_entry_point</span><span class="p">,</span>
                                 <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                 <span class="n">MY_PRIORITY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">K_NO_WAIT</span><span class="p">);</span>
</pre></div>
</div>
<p>Alternatively, a thread can be spawned at compile time by calling
<a class="reference internal" href="../../api/kernel_api.html#c.K_THREAD_DEFINE" title="K_THREAD_DEFINE"><code class="xref c c-macro docutils literal"><span class="pre">K_THREAD_DEFINE</span></code></a>. Observe that the macro defines
the stack area, control block, and thread id variables automatically.</p>
<p>The following code has the same effect as the code segment above.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define MY_STACK_SIZE 500</span>
<span class="cp">#define MY_PRIORITY 5</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="nf">my_entry_point</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>

<span class="n">K_THREAD_DEFINE</span><span class="p">(</span><span class="n">my_tid</span><span class="p">,</span> <span class="n">MY_STACK_SIZE</span><span class="p">,</span>
                <span class="n">my_entry_point</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                <span class="n">MY_PRIORITY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">K_NO_WAIT</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="user-mode-constraints">
<h4>User Mode Constraints<a class="headerlink" href="#user-mode-constraints" title="Permalink to this headline">¶</a></h4>
<p>This section only applies if <a class="reference internal" href="../../reference/kconfig/CONFIG_USERSPACE.html#cmdoption-arg-config-userspace"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_USERSPACE</span></code></a> is enabled, and a user
thread tries to create a new thread. The <code class="xref c c-func docutils literal"><span class="pre">k_thread_create()</span></code> API is
still used, but there are additional constraints which must be met or the
calling thread will be terminated:</p>
<ul class="simple">
<li>The calling thread must have permissions granted on both the child thread
and stack parameters; both are tracked by the kernel as kernel objects.</li>
<li>The child thread and stack objects must be in an uninitialized state,
i.e. it is not currently running and the stack memory is unused.</li>
<li>The stack size parameter passed in must be equal to or less than the
bounds of the stack object when it was declared.</li>
<li>The <a class="reference internal" href="../../api/kernel_api.html#c.K_USER" title="K_USER"><code class="xref c c-macro docutils literal"><span class="pre">K_USER</span></code></a> option must be used, as user threads can only create
other user threads.</li>
<li>The <a class="reference internal" href="../../api/kernel_api.html#c.K_ESSENTIAL" title="K_ESSENTIAL"><code class="xref c c-macro docutils literal"><span class="pre">K_ESSENTIAL</span></code></a> option must not be used, user threads may not be
considered essential threads.</li>
<li>The priority of the child thread must be a valid priority value, and equal to
or lower than the parent thread.</li>
</ul>
</div>
</div>
<div class="section" id="dropping-permissions">
<h3><a class="toc-backref" href="#id9">Dropping Permissions</a><a class="headerlink" href="#dropping-permissions" title="Permalink to this headline">¶</a></h3>
<p>If <a class="reference internal" href="../../reference/kconfig/CONFIG_USERSPACE.html#cmdoption-arg-config-userspace"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_USERSPACE</span></code></a> is enabled, a thread running in supervisor mode
may perform a one-way transition to user mode using the
<a class="reference internal" href="../../api/kernel_api.html#_CPPv224k_thread_user_mode_enter16k_thread_entry_tPvPvPv" title="k_thread_user_mode_enter"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_thread_user_mode_enter()</span></code></a> API. This is a one-way operation which
will reset and zero the thread’s stack memory. The thread will be marked
as non-essential.</p>
</div>
<div class="section" id="terminating-a-thread">
<h3><a class="toc-backref" href="#id10">Terminating a Thread</a><a class="headerlink" href="#terminating-a-thread" title="Permalink to this headline">¶</a></h3>
<p>A thread terminates itself by returning from its entry point function.</p>
<p>The following code illustrates the ways a thread can terminate.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">my_entry_point</span><span class="p">(</span><span class="kt">int</span> <span class="n">unused1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">unused2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">unused3</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">...</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">some</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span> <span class="cm">/* thread terminates from mid-entry point function */</span>
        <span class="p">}</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="cm">/* thread terminates at end of entry point function */</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If CONFIG_USERSPACE is enabled, aborting a thread will additionally mark the
thread and stack objects as uninitialized so that they may be re-used.</p>
</div>
</div>
<div class="section" id="suggested-uses">
<h2><a class="toc-backref" href="#id11">Suggested Uses</a><a class="headerlink" href="#suggested-uses" title="Permalink to this headline">¶</a></h2>
<p>Use threads to handle processing that cannot be handled in an ISR.</p>
<p>Use separate threads to handle logically distinct processing operations
that can execute in parallel.</p>
</div>
<div class="section" id="configuration-options">
<h2><a class="toc-backref" href="#id12">Configuration Options</a><a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h2>
<p>Related configuration options:</p>
<ul class="simple">
<li><a class="reference internal" href="../../reference/kconfig/CONFIG_USERSPACE.html#cmdoption-arg-config-userspace"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_USERSPACE</span></code></a></li>
</ul>
</div>
<div class="section" id="apis">
<h2><a class="toc-backref" href="#id13">APIs</a><a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h2>
<p>The following thread APIs are provided by <code class="file docutils literal"><span class="pre">kernel.h</span></code>:</p>
<ul class="simple">
<li><a class="reference internal" href="../../api/kernel_api.html#c.K_THREAD_DEFINE" title="K_THREAD_DEFINE"><code class="xref c c-macro docutils literal"><span class="pre">K_THREAD_DEFINE</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv215k_thread_createP8k_threadP16k_thread_stack_t6size_t16k_thread_entry_tPvPvPvi5u32_t5s32_t" title="k_thread_create"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_thread_create()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv215k_thread_cancel7k_tid_t" title="k_thread_cancel"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_thread_cancel()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv214k_thread_abort7k_tid_t" title="k_thread_abort"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_thread_abort()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv216k_thread_suspend7k_tid_t" title="k_thread_suspend"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_thread_suspend()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv215k_thread_resume7k_tid_t" title="k_thread_resume"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_thread_resume()</span></code></a></li>
<li><code class="xref c c-macro docutils literal"><span class="pre">K_THREAD_STACK_DEFINE</span></code></li>
<li><code class="xref c c-macro docutils literal"><span class="pre">K_THREAD_STACK_ARRAY_DEFINE</span></code></li>
<li><code class="xref c c-macro docutils literal"><span class="pre">K_THREAD_STACK_MEMBER</span></code></li>
<li><code class="xref c c-macro docutils literal"><span class="pre">K_THREAD_STACK_SIZEOF</span></code></li>
<li><code class="xref c c-macro docutils literal"><span class="pre">K_THREAD_STACK_BUFFER</span></code></li>
</ul>
</div>
</div>


                </div>
              </div>
              <!-- 
  <div class="rst-footer-buttons row" role="navigation" aria-label="footer navigation">
    
      <a href="scheduling.html" class="btn btn-neutral float-right" title="Scheduling" accesskey="n">
        Next <span class="fa fa-arrow-circle-right"></span>
      </a>
    
    
      <a href="threads.html" class="btn btn-neutral" title="Threads" accesskey="p">
        <span class="fa fa-arrow-circle-left"></span> Previous
      </a>
    
  </div>
  for ZEP-463 remove the prev/next links -->
            </div>
            <!-- ENDS #content SECTION -->
          </section>
          <!-- ENDS .content -->
        </div>
        <!-- ENDS .main-container -->
      </div>
      <!-- ENDS #main -->
      <footer id="footer">
  <div class="container">
    <div class="block block-menu block-odd first block" data-bid="menu-footer-menu">
      <h3 class="title">Footer Menu</h3>
      <ul class="menu">
        <li class="leaf google- mid-2404">
          <a href="https://plus.google.com/+ZephyrProject" class="google-plus"><span>Google+</span></a>
        </li>
        <li class="leaf twitter mid-2405">
          <a href="https://twitter.com/zephyriot" class="twitter"><span>Twitter</span></a>
        </li>
        <li class="last leaf email mid-2406">
          <a href="mailto:info@zephyrproject.org" class="email"><span>Email</span></a>
        </li>
      </ul>
    </div>
    <div class="block block-block block-even block" data-bid="block-4">
      <p>
        Zephyr Project © 2018 is a Linux Foundation Project. All Rights Reserved.
      </p>
      <p>
        <a href="https://linuxfoundation.org" target="_blank">Linux Foundation</a> is a registered trademark of The Linux Foundation. Linux is a registered <a href="https://www.linuxfoundation.org/about/linux-foundation-trademark-usage-guidelines" target="_blank">trademark</a> of Linus Torvalds.
      </p>
      <p>
        Please see our <a href="https://www.linuxfoundation.org/privacy" target="_blank">privacy policy</a> and <a href="https://www.linuxfoundation.org/terms" target="_blank">terms of use</a>
      </p>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #page -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.10.99',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/js/main.js"></script>
      <script type="text/javascript" src="../../_static/js/app.js"></script>
      <script type="text/javascript" src="../../_static/js/affix.js"></script>

   

  </body>
</html>