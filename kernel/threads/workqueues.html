

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" > <!--<![endif]-->
  <head>
    <meta charset="utf-8">
   <!-- Google Tag Manager -->
   <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
   new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
   j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
   })(window,document,'script','dataLayer','GTM-KMP8MS');</script>
   <!-- End Google Tag Manager -->
    <link rel="apple-touch-icon" sizes="57x57" href="../../_static/img/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../../_static/img/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../../_static/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../../_static/img/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../../_static/img/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../../_static/img/apple-touch-icon-120x120.png">
    <link rel="icon" type="image/png" href="../../_static/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../../_static/img/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="../../_static/img/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="../../_static/manifest.json">
    <meta name="apple-mobile-web-app-title" content="Zephyr Project">
    <meta name="application-name" content="Zephyr Project">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    
    <title>Workqueue Threads &mdash; Zephyr Project Documentation</title>
    

    
    

    

    
    
      
    

    
    
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    

    
      <link rel="stylesheet" href="../../_static/zephyr-custom.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/normalize.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/layout.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    

    
        <link rel="index" title="Index" href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
        <link rel="copyright" title="Copyright" href="../../copyright.html"/>
      <link rel="top" title="Zephyr Project Documentation" href="../../index.html"/>
        <link rel="up" title="Threads" href="threads.html"/>
        <link rel="next" title="Timing" href="../timing/timing.html"/>
        <link rel="prev" title="System Threads" href="system_threads.html"/> 

    
    <script src="../../_static/js/modernizr.min.js"></script>

  </head>

  <body class="not-front page-documentation one-sidebar sidebar-first" role="document" >
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KMP8MS"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="page">
      <header id="header">
  <div class="header-wrapper">
    <div class="container">
      <a href="https://zephyrproject.org/" title="Zephyr Project" rel="home" id="logo">
        <img src="../../_static/img/logo_white.png" alt="Zephyr Project">
      </a>
      <a href="" id="navigation-toggle">
        <span> </span>
        Menu
      </a>
      <nav id="navigation" class="menu with-primary with-secondary">
        <ul class="header-menu main-menu">
          <li class="first expanded about mid-1209"><a href="https://zephyrproject.org/about/"><span>About</span></a>
            <ul class="menu">
              <li class="first leaf what-is-zephyr mid-2563"><a href="https://zephyrproject.org/what-is-zephyr/"><span>What is the Zephyr Project?</span></a></li>
              <li class="leaf organization mid-2564"><a href="https://zephyrproject.org/about/organization/"><span>Organization</span></a></li>
              <li class="leaf memberships mid-2532"><a href="https://zephyrproject.org/#members"><span>Members</span></a></li>
              <li class="leaf faq mid-2525"><a href="https://zephyrproject.org/about/#faq"><span>FAQ</span></a></li>
              <li class="leaf join mid-2622"><a href="https://zephyrproject.org/join/"><span>Join</span></a></li>
              <li class="last leaf contact-us mid-2530"><a href="https://zephyrproject.org/about/#contact-us"><span>Contact Us</span></a></li>
            </ul>
          </li>
          <li class="expanded developers mid-1209"><a href="https://zephyrproject.org/developers/"><span>Developers</span></a>
            <ul class="menu">
              <li class="first expanded leaf code mid-2563"><a href="https://github.com/zephyrproject-rtos/zephyr/" target="_blank"><span>Code</span></a></li>
              <li class="leaf downloads mid-2564"><a href="https://zephyrproject.org/developers/#downloads"><span>Downloads</span></a></li>
              <li class="leaf documentation mid-2564"><a href="http://docs.zephyrproject.org/index.html" target="_blank"><span>Documentation</span></a></li>
              <li class="leaf supported-boards mid-2564"><a href="http://docs.zephyrproject.org/boards/boards.html" target="_blank"><span>Supported Boards</span></a></li>
              <li class="leaf releases-overview mid-2564"><a href="https://zephyrproject.org/developers/#releases-overview"><span>Releases Overview</span></a></li>
              <li class="leaf how-to-contribute mid-2564"><a href="https://zephyrproject.org/developers/how-to-contribute/"><span>How to Contribute</span></a></li>
              <li class="last leaf community-guidelines mid-2564"><a href="https://zephyrproject.org/developers/how-to-contribute/#community-guidelines"><span>Community Guidelines</span></a></li>
            </ul>
          </li>
          <li class="expanded news mid-1209"><a href="https://zephyrproject.org/news/"><span>News</span></a>
            <ul class="menu">
              <li class="first leaf announcements mid-2563"><a href="https://zephyrproject.org/news/announcements/"><span>Announcements</span></a></li>
              <li class="leaf blog mid-2563"><a href="https://zephyrproject.org/news/blog/"><span>Blog</span></a></li>
              <li class="last leaf events mid-2563"><a href="https://zephyrproject.org/events/"><span>Events</span></a></li>
            </ul>
          </li>
          <li class="last expanded project-resources mid-1209"><a href="https://zephyrproject.org/project-resources/"><span>Project Resources</span></a>
            <ul class="menu">
              <li class="first leaf presentations mid-2563"><a href="https://zephyrproject.org/project-resources/presentations/"><span>Presentations</span></a></li>
              <li class="leaf videos mid-2563"><a href="https://zephyrproject.org/project-resources/videos/"><span>Videos</span></a></li>
              <li class="leaf demos mid-2563"><a href="https://zephyrproject.org/project-resources/demos/"><span>Demos</span></a></li>
              <li class="leaf zephyr-in-market mid-2563"><a href="https://zephyrproject.org/project-resources/zephyr-in-market/"><span>Zephyr in Market</span></a></li>
              <li class="last leaf developer-tools mid-2563"><a href="https://zephyrproject.org/project-resources/developer-tools/"><span>Developer Tools</span></a></li>
            </ul>
          </li>
        </ul>
      </nav><!-- /navigation -->
    </div>
  </div>
</header><!-- /header -->
      <!-- STARTS #main -->
      <div id="main">
        <!-- STARTS .main-container -->
        <div class="main-container">
          

 



<!-- Docs -->





<div id="breadcrumb">
  <div class="container">
    <a href="/">Home</a> / 
    <a href="../../index.html">Docs</a> /
      
          <a href="../kernel.html">Zephyr Kernel Primer</a> /
      
          <a href="threads.html">Threads</a> /
      
  </div>
</div>
          <aside id="sidebar-first" class="container-sidebar">
            
            <span id="secondary-menu-button" class="">Documentation</span>
<div class="region region-sidebar">
  <div class="docs-menu">
  
    
    
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/introducing_zephyr.html">Introducing Zephyr</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started.html">Getting Started Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/contribute.html">Contributing to the Zephyr Project</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../kernel.html">Zephyr Kernel Primer</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/overview.html">Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="threads.html">Threads</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lifecycle.html">Lifecycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="scheduling.html">Scheduling</a></li>
<li class="toctree-l3"><a class="reference internal" href="custom_data.html">Custom Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="system_threads.html">System Threads</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Workqueue Threads</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../timing/timing.html">Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory/memory.html">Memory Allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../synchronization/synchronization.html">Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_passing/data_passing.html">Data Passing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usermode/usermode.html">User Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../other/other.html">Other Services</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../security/security.html">Zephyr Project Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application/index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boards/boards.html">Supported Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devices/index.html">Device and Driver Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../subsystems/subsystems.html">Subsystems</a></li>
</ul>

    
  
  </div>
<div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
</div>
          </aside>
          <!-- STARTS .content SECTION-->
          <section id="content" class="row">
            
	    
            <div class="rst-content">
              <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                <div itemprop="articleBody">
                  
  <div class="section" id="workqueue-threads">
<span id="workqueues-v2"></span><h1>Workqueue Threads<a class="headerlink" href="#workqueue-threads" title="Permalink to this headline">¶</a></h1>
<p>A <em class="dfn">workqueue</em> is a kernel object that uses a dedicated thread to process
work items in a first in, first out manner. Each work item is processed by
calling the function specified by the work item. A workqueue is typically
used by an ISR or a high-priority thread to offload non-urgent processing
to a lower-priority thread so it does not impact time-sensitive processing.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#concepts" id="id1">Concepts</a><ul>
<li><a class="reference internal" href="#work-item-lifecycle" id="id2">Work Item Lifecycle</a></li>
<li><a class="reference internal" href="#delayed-work" id="id3">Delayed Work</a></li>
<li><a class="reference internal" href="#system-workqueue" id="id4">System Workqueue</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation" id="id5">Implementation</a><ul>
<li><a class="reference internal" href="#defining-a-workqueue" id="id6">Defining a Workqueue</a></li>
<li><a class="reference internal" href="#submitting-a-work-item" id="id7">Submitting a Work Item</a></li>
<li><a class="reference internal" href="#submitting-a-delayed-work-item" id="id8">Submitting a Delayed Work Item</a></li>
</ul>
</li>
<li><a class="reference internal" href="#suggested-uses" id="id9">Suggested Uses</a></li>
<li><a class="reference internal" href="#configuration-options" id="id10">Configuration Options</a></li>
<li><a class="reference internal" href="#apis" id="id11">APIs</a></li>
</ul>
</div>
<div class="section" id="concepts">
<h2><a class="toc-backref" href="#id1">Concepts</a><a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h2>
<p>Any number of workqueues can be defined. Each workqueue is referenced by its
memory address.</p>
<p>A workqueue has the following key properties:</p>
<ul class="simple">
<li>A <strong>queue</strong> of work items that have been added, but not yet processed.</li>
<li>A <strong>thread</strong> that processes the work items in the queue. The priority of the
thread is configurable, allowing it to be either cooperative or preemptive
as required.</li>
</ul>
<p>A workqueue must be initialized before it can be used. This sets its queue
to empty and spawns the workqueue’s thread.</p>
<div class="section" id="work-item-lifecycle">
<h3><a class="toc-backref" href="#id2">Work Item Lifecycle</a><a class="headerlink" href="#work-item-lifecycle" title="Permalink to this headline">¶</a></h3>
<p>Any number of <strong>work items</strong> can be defined. Each work item is referenced
by its memory address.</p>
<p>A work item has the following key properties:</p>
<ul class="simple">
<li>A <strong>handler function</strong>, which is the function executed by the workqueue’s
thread when the work item is processed. This function accepts a single
argument, which is the address of the work item itself.</li>
<li>A <strong>pending flag</strong>, which is used by the kernel to signify that the
work item is currently a member of a workqueue’s queue.</li>
<li>A <strong>queue link</strong>, which is used by the kernel to link a pending work
item to the next pending work item in a workqueue’s queue.</li>
</ul>
<p>A work item must be initialized before it can be used. This records the work
item’s handler function and marks it as not pending.</p>
<p>A work item may be <strong>submitted</strong> to a workqueue by an ISR or a thread.
Submitting a work item appends the work item to the workqueue’s queue.
Once the workqueue’s thread has processed all of the preceding work items
in its queue the thread will remove a pending work item from its queue and
invoke the work item’s handler function. Depending on the scheduling priority
of the workqueue’s thread, and the work required by other items in the queue,
a pending work item may be processed quickly or it may remain in the queue
for an extended period of time.</p>
<p>A handler function can utilize any kernel API available to threads. However,
operations that are potentially blocking (e.g. taking a semaphore) must be
used with care, since the workqueue cannot process subsequent work items in
its queue until the handler function finishes executing.</p>
<p>The single argument that is passed to a handler function can be ignored if
it is not required. If the handler function requires additional information
about the work it is to perform, the work item can be embedded in a larger
data structure. The handler function can then use the argument value to compute
the address of the enclosing data structure, and thereby obtain access to the
additional information it needs.</p>
<p>A work item is typically initialized once and then submitted to a specific
workqueue whenever work needs to be performed. If an ISR or a thread attempts
to submit a work item that is already pending, the work item is not affected;
the work item remains in its current place in the workqueue’s queue, and
the work is only performed once.</p>
<p>A handler function is permitted to re-submit its work item argument
to the workqueue, since the work item is no longer pending at that time.
This allows the handler to execute work in stages, without unduly delaying
the processing of other work items in the workqueue’s queue.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">A pending work item <em>must not</em> be altered until the item has been processed
by the workqueue thread. This means a work item must not be re-initialized
while it is pending. Furthermore, any additional information the work item’s
handler function needs to perform its work must not be altered until
the handler function has finished executing.</p>
</div>
</div>
<div class="section" id="delayed-work">
<h3><a class="toc-backref" href="#id3">Delayed Work</a><a class="headerlink" href="#delayed-work" title="Permalink to this headline">¶</a></h3>
<p>An ISR or a thread may need to schedule a work item that is to be processed
only after a specified period of time, rather than immediately. This can be
done by submitting a <strong>delayed work item</strong> to a workqueue, rather than a
standard work item.</p>
<p>A delayed work item is a standard work item that has the following added
properties:</p>
<ul class="simple">
<li>A <strong>delay</strong> specifying the time interval to wait before the work item
is actually submitted to a workqueue’s queue.</li>
<li>A <strong>workqueue indicator</strong> that identifies the workqueue the work item
is to be submitted to.</li>
</ul>
<p>A delayed work item is initialized and submitted to a workqueue in a similar
manner to a standard work item, although different kernel APIs are used.
When the submit request is made the kernel initiates a timeout mechanism
that is triggered after the specified delay has elapsed. Once the timeout
occurs the kernel submits the delayed work item to the specified workqueue,
where it remains pending until it is processed in the standard manner.</p>
<p>An ISR or a thread may <strong>cancel</strong> a delayed work item it has submitted,
providing the work item’s timeout is still counting down. The work item’s
timeout is aborted and the specified work is not performed.</p>
<p>Attempting to cancel a delayed work item once its timeout has expired has
no effect on the work item; the work item remains pending in the workqueue’s
queue, unless the work item has already been removed and processed by the
workqueue’s thread. Consequently, once a work item’s timeout has expired
the work item is always processed by the workqueue and cannot be canceled.</p>
</div>
<div class="section" id="system-workqueue">
<h3><a class="toc-backref" href="#id4">System Workqueue</a><a class="headerlink" href="#system-workqueue" title="Permalink to this headline">¶</a></h3>
<p>The kernel defines a workqueue known as the <em>system workqueue</em>, which is
available to any application or kernel code that requires workqueue support.
The system workqueue is optional, and only exists if the application makes
use of it.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Additional workqueues should only be defined when it is not possible
to submit new work items to the system workqueue, since each new workqueue
incurs a significant cost in memory footprint. A new workqueue can be
justified if it is not possible for its work items to co-exist with
existing system workqueue work items without an unacceptable impact;
for example, if the new work items perform blocking operations that
would delay other system workqueue processing to an unacceptable degree.</p>
</div>
</div>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id5">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="defining-a-workqueue">
<h3><a class="toc-backref" href="#id6">Defining a Workqueue</a><a class="headerlink" href="#defining-a-workqueue" title="Permalink to this headline">¶</a></h3>
<p>A workqueue is defined using a variable of type <code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">k_work_q</span></code>.
The workqueue is initialized by defining the stack area used by its thread
and then calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv214k_work_q_startP8k_work_qP16k_thread_stack_t6size_ti" title="k_work_q_start"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_work_q_start()</span></code></a>. The stack area must be defined
using <code class="xref c c-macro docutils literal"><span class="pre">K_THREAD_STACK_DEFINE</span></code> to ensure it is properly set up in
memory.</p>
<p>The following code defines and initializes a workqueue.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#define MY_STACK_SIZE 512</span>
<span class="cp">#define MY_PRIORITY 5</span>

<span class="n">K_THREAD_STACK_DEFINE</span><span class="p">(</span><span class="n">my_stack_area</span><span class="p">,</span> <span class="n">MY_STACK_SIZE</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">k_work_q</span> <span class="n">my_work_q</span><span class="p">;</span>

<span class="n">k_work_q_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_work_q</span><span class="p">,</span> <span class="n">my_stack_area</span><span class="p">,</span>
               <span class="n">K_THREAD_STACK_SIZEOF</span><span class="p">(</span><span class="n">my_stack_area</span><span class="p">),</span> <span class="n">MY_PRIORITY</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="submitting-a-work-item">
<h3><a class="toc-backref" href="#id7">Submitting a Work Item</a><a class="headerlink" href="#submitting-a-work-item" title="Permalink to this headline">¶</a></h3>
<p>A work item is defined using a variable of type <code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">k_work</span></code>.
It must then be initialized by calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv211k_work_initP6k_work16k_work_handler_t" title="k_work_init"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_work_init()</span></code></a>.</p>
<p>An initialized work item can be submitted to the system workqueue by
calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv213k_work_submitP6k_work" title="k_work_submit"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_work_submit()</span></code></a>, or to a specified workqueue by
calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv222k_work_submit_to_queueP8k_work_qP6k_work" title="k_work_submit_to_queue"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_work_submit_to_queue()</span></code></a>.</p>
<p>The following code demonstrates how an ISR can offload the printing
of error messages to the system workqueue. Note that if the ISR attempts
to resubmit the work item while it is still pending, the work item is left
unchanged and the associated error message will not be printed.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">device_info</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">k_work</span> <span class="n">work</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>
<span class="p">}</span> <span class="n">my_device</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">my_isr</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="n">detected</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">k_work_submit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_device</span><span class="p">.</span><span class="n">work</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">print_error</span><span class="p">(</span><span class="k">struct</span> <span class="n">k_work</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">device_info</span> <span class="o">*</span><span class="n">the_device</span> <span class="o">=</span>
        <span class="n">CONTAINER_OF</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_info</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
    <span class="n">printk</span><span class="p">(</span><span class="s">&quot;Got error on device %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">the_device</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* initialize name info for a device */</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">my_device</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;FOO_dev&quot;</span><span class="p">);</span>

<span class="cm">/* initialize work item for printing device&#39;s error messages */</span>
<span class="n">k_work_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_device</span><span class="p">.</span><span class="n">work</span><span class="p">,</span> <span class="n">print_error</span><span class="p">);</span>

<span class="cm">/* install my_isr() as interrupt handler for the device (not shown) */</span>
<span class="p">...</span>
</pre></div>
</div>
</div>
<div class="section" id="submitting-a-delayed-work-item">
<h3><a class="toc-backref" href="#id8">Submitting a Delayed Work Item</a><a class="headerlink" href="#submitting-a-delayed-work-item" title="Permalink to this headline">¶</a></h3>
<p>A delayed work item is defined using a variable of type
<code class="xref c c-type docutils literal"><span class="pre">struct</span> <span class="pre">k_delayed_work</span></code>. It must then be initialized by calling
<a class="reference internal" href="../../api/kernel_api.html#_CPPv219k_delayed_work_initP14k_delayed_work16k_work_handler_t" title="k_delayed_work_init"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_delayed_work_init()</span></code></a>.</p>
<p>An initialized delayed work item can be submitted to the system workqueue by
calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv221k_delayed_work_submitP14k_delayed_work5s32_t" title="k_delayed_work_submit"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_delayed_work_submit()</span></code></a>, or to a specified workqueue by
calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv230k_delayed_work_submit_to_queueP8k_work_qP14k_delayed_work5s32_t" title="k_delayed_work_submit_to_queue"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_delayed_work_submit_to_queue()</span></code></a>. A delayed work item
that has been submitted but not yet consumed by its workqueue can be canceled
by calling <a class="reference internal" href="../../api/kernel_api.html#_CPPv221k_delayed_work_cancelP14k_delayed_work" title="k_delayed_work_cancel"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_delayed_work_cancel()</span></code></a>.</p>
</div>
</div>
<div class="section" id="suggested-uses">
<h2><a class="toc-backref" href="#id9">Suggested Uses</a><a class="headerlink" href="#suggested-uses" title="Permalink to this headline">¶</a></h2>
<p>Use the system workqueue to defer complex interrupt-related processing
from an ISR to a cooperative thread. This allows the interrupt-related
processing to be done promptly without compromising the system’s ability
to respond to subsequent interrupts, and does not require the application
to define an additional thread to do the processing.</p>
</div>
<div class="section" id="configuration-options">
<h2><a class="toc-backref" href="#id10">Configuration Options</a><a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h2>
<p>Related configuration options:</p>
<ul class="simple">
<li><a class="reference internal" href="../../reference/kconfig/CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE.html#cmdoption-arg-config-system-workqueue-stack-size"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE</span></code></a></li>
<li><a class="reference internal" href="../../reference/kconfig/CONFIG_SYSTEM_WORKQUEUE_PRIORITY.html#cmdoption-arg-config-system-workqueue-priority"><code class="xref std std-option docutils literal"><span class="pre">CONFIG_SYSTEM_WORKQUEUE_PRIORITY</span></code></a></li>
</ul>
</div>
<div class="section" id="apis">
<h2><a class="toc-backref" href="#id11">APIs</a><a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv214k_work_q_startP8k_work_qP16k_thread_stack_t6size_ti" title="k_work_q_start"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_work_q_start()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv211k_work_initP6k_work16k_work_handler_t" title="k_work_init"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_work_init()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv213k_work_submitP6k_work" title="k_work_submit"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_work_submit()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv222k_work_submit_to_queueP8k_work_qP6k_work" title="k_work_submit_to_queue"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_work_submit_to_queue()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv219k_delayed_work_initP14k_delayed_work16k_work_handler_t" title="k_delayed_work_init"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_delayed_work_init()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv221k_delayed_work_submitP14k_delayed_work5s32_t" title="k_delayed_work_submit"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_delayed_work_submit()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv230k_delayed_work_submit_to_queueP8k_work_qP14k_delayed_work5s32_t" title="k_delayed_work_submit_to_queue"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_delayed_work_submit_to_queue()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv221k_delayed_work_cancelP14k_delayed_work" title="k_delayed_work_cancel"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_delayed_work_cancel()</span></code></a></li>
<li><a class="reference internal" href="../../api/kernel_api.html#_CPPv214k_work_pendingP6k_work" title="k_work_pending"><code class="xref cpp cpp-func docutils literal"><span class="pre">k_work_pending()</span></code></a></li>
</ul>
</div>
</div>


                </div>
              </div>
              <!-- 
  <div class="rst-footer-buttons row" role="navigation" aria-label="footer navigation">
    
      <a href="../timing/timing.html" class="btn btn-neutral float-right" title="Timing" accesskey="n">
        Next <span class="fa fa-arrow-circle-right"></span>
      </a>
    
    
      <a href="system_threads.html" class="btn btn-neutral" title="System Threads" accesskey="p">
        <span class="fa fa-arrow-circle-left"></span> Previous
      </a>
    
  </div>
  for ZEP-463 remove the prev/next links -->
            </div>
            <!-- ENDS #content SECTION -->
          </section>
          <!-- ENDS .content -->
        </div>
        <!-- ENDS .main-container -->
      </div>
      <!-- ENDS #main -->
      <footer id="footer">
  <div class="container">
    <div class="block block-menu block-odd first block" data-bid="menu-footer-menu">
      <h3 class="title">Footer Menu</h3>
      <ul class="menu">
        <li class="leaf google- mid-2404">
          <a href="https://plus.google.com/+ZephyrProject" class="google-plus"><span>Google+</span></a>
        </li>
        <li class="leaf twitter mid-2405">
          <a href="https://twitter.com/zephyriot" class="twitter"><span>Twitter</span></a>
        </li>
        <li class="last leaf email mid-2406">
          <a href="mailto:info@zephyrproject.org" class="email"><span>Email</span></a>
        </li>
      </ul>
    </div>
    <div class="block block-block block-even block" data-bid="block-4">
      <p>
        Zephyr Project © 2018 is a Linux Foundation Project. All Rights Reserved.
      </p>
      <p>
        <a href="https://linuxfoundation.org" target="_blank">Linux Foundation</a> is a registered trademark of The Linux Foundation. Linux is a registered <a href="https://www.linuxfoundation.org/about/linux-foundation-trademark-usage-guidelines" target="_blank">trademark</a> of Linus Torvalds.
      </p>
      <p>
        Please see our <a href="https://www.linuxfoundation.org/privacy" target="_blank">privacy policy</a> and <a href="https://www.linuxfoundation.org/terms" target="_blank">terms of use</a>
      </p>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #page -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.10.99',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/js/main.js"></script>
      <script type="text/javascript" src="../../_static/js/app.js"></script>
      <script type="text/javascript" src="../../_static/js/affix.js"></script>

   

  </body>
</html>